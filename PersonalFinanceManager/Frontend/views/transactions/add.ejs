<div class="row mt-5">
    <div class="col-md-8 m-auto">
        <div class="card card-body bg-dark text-light border-secondary">
            <h1 class="text-center mb-3 text-light">
                Dodaj Transakcję: <%= account ? account.name : 'Nieznane konto' %>
            </h1>
            
            <form action="/accounts/<%= account.id %>/transactions/add" method="POST">
                <div class="mb-3">
                    <label for="type" class="form-label">Typ Transakcji</label>
                    <select id="type" name="type" class="form-select bg-secondary text-light border-0" required onchange="toggleTransactionFields()">
                        <option value="expense">Wydatek</option>
                        <option value="income">Przychód</option>
                        <option value="transfer">Transfer</option>
                    </select>
                </div>

                <div class="mb-3" id="categoryField">
                    <label for="category" class="form-label">Kategoria</label>
                    <select id="category" name="category" class="form-select bg-secondary text-light border-0">
                        <option value="">Wybierz kategorię</option>
                        <% if (typeof categories !== 'undefined') { %>
                            <% categories.forEach(cat => { %>
                                <option value="<%= cat.id %>">
                                    <%= cat.name %>
                                </option>
                            <% }) %>
                        <% } %>
                    </select>
                </div>

                <div class="mb-3" id="senderAccountField" style="display: none;">
                    <label for="senderAccountId" class="form-label">Z konta</label>
                    <select id="senderAccountId" name="senderAccountId" class="form-select bg-secondary text-light border-0">
                        <option value="<%= account.id %>" selected><%= account.name %></option>
                        <% if (typeof userAccounts !== 'undefined') { %>
                            <% userAccounts.forEach(acc => { %>
                                <% if(acc.id !== account.id) { %>
                                    <option value="<%= acc.id %>"><%= acc.name %></option>
                                <% } %>
                            <% }) %>
                        <% } %>
                    </select>
                </div>

                <div class="mb-3" id="receiverAccountField" style="display: none;">
                    <label for="receiverAccountId" class="form-label">Na konto</label>
                    <select id="receiverAccountId" name="receiverAccountId" class="form-select bg-secondary text-light border-0">
                        <option value="">Wybierz konto odbiorcy</option>
                        <% if (typeof userAccounts !== 'undefined') { %>
                            <% userAccounts.forEach(acc => { %>
                                <% if(acc.id !== account.id) { %>
                                    <option value="<%= acc.id %>"><%= acc.name %></option>
                                <% } %>
                            <% }) %>
                        <% } %>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="amount" class="form-label">Kwota (<%= account.currencyCode || account.currency || 'PLN' %>)</label>
                    <input
                        type="number"
                        id="amount"
                        name="amount"
                        class="form-control bg-secondary text-light border-0"
                        step="0.01"
                        placeholder="0.00"
                        required
                    />
                    <small class="text-muted">Dla wydatków system automatycznie doda minus.</small>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">Opis / Nazwa</label>
                    <textarea
                        id="description"
                        name="description"
                        class="form-control bg-secondary text-light border-0"
                        rows="2"
                        placeholder="Np. Zakupy spożywcze"
                        required
                    ></textarea>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">Zapisz transakcję</button>
                    <a href="/accounts/<%= account.id %>/transactions" class="btn btn-outline-secondary">Anuluj</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function toggleTransactionFields() {
        const type = document.getElementById('type').value;
        const categoryField = document.getElementById('categoryField');
        const senderAccountField = document.getElementById('senderAccountField');
        const receiverAccountField = document.getElementById('receiverAccountField');
        const categorySelect = document.getElementById('category');

        if (type === 'transfer') {
            categoryField.style.display = 'none';
            senderAccountField.style.display = 'block';
            receiverAccountField.style.display = 'block';
            categorySelect.removeAttribute('required');
        } else {
            categoryField.style.display = 'block';
            senderAccountField.style.display = 'none';
            receiverAccountField.style.display = 'none';
            categorySelect.setAttribute('required', 'required');
        }
    }
    // Uruchom przy starcie, żeby ukryć odpowiednie pola
    document.addEventListener('DOMContentLoaded', toggleTransactionFields);
</script>